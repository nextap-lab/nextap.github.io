<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Nextap AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #171717;
            --secondary-color: #404041;
            --accent-color: #3b82f6;
            --text-color: #f3f4f6;
        }

        body {
            background-color: #000;
            color: var(--text-color);
            min-height: 100vh;
        }

        .nav-blur {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .glass-card {
            background: rgba(23, 23, 23, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .admin-table thead th {
            background: rgba(23, 23, 23, 0.98);
            position: sticky;
            top: 64px;
            z-index: 10;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .status-pending {
            background: rgba(234, 179, 8, 0.1);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .status-active {
            background: rgba(34, 197, 94, 0.1);
            color: #4ade80;
            border: 1px solid rgba(74, 222, 128, 0.2);
        }

        .status-completed {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            border: 1px solid rgba(96, 165, 250, 0.2);
        }

        .project-row {
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease-out;
        }

        .project-row:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .custom-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .custom-input:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.08);
            outline: none;
        }

        .stats-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.7));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.15);
        }

        .login-container {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9));
            backdrop-filter: blur(10px);
            animation: fadeScale 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeScale {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .save-button {
            position: relative;
            overflow: hidden;
        }

        .save-button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .save-button:hover::after {
            transform: translateX(100%);
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
        <div class="login-container w-full max-w-md p-8 rounded-2xl">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold bg-gradient-to-r from-blue-400 to-blue-600 text-transparent bg-clip-text">Admin Login</h2>
                <p class="text-gray-400 mt-2">Enter your credentials to continue</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Username</label>
                    <input type="text" id="username" required
                        class="custom-input w-full px-4 py-3 rounded-lg text-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Password</label>
                    <input type="password" id="password" required
                        class="custom-input w-full px-4 py-3 rounded-lg text-lg">
                </div>
                <button type="submit"
                    class="w-full bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 transition-all text-lg font-medium save-button">
                    Login to Dashboard
                </button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="adminDashboard" class="hidden">
        <!-- Navigation -->
        <nav class="fixed w-full z-50 nav-blur">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between h-16 items-center">
                    <a href="#" class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-blue-600 text-transparent bg-clip-text">
                        Nextap AI Admin
                    </a>
                    <div class="flex items-center space-x-6">
                        <button onclick="refresh()" class="text-gray-400 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>
                        <button onclick="logout()" class="text-gray-400 hover:text-white transition-colors flex items-center gap-2">
                            <span>Logout</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Dashboard Content -->
        <div class="pt-20 pb-12 max-w-7xl mx-auto px-4">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div class="stats-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-4xl font-bold text-blue-400 mb-2">24</div>
                            <div class="text-gray-400">Active Projects</div>
                        </div>
                        <div class="text-blue-400">
                            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="stats-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-4xl font-bold text-blue-400 mb-2">8</div>
                            <div class="text-gray-400">Pending Approvals</div>
                        </div>
                        <div class="text-blue-400">
                            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="stats-card rounded-xl p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-4xl font-bold text-blue-400 mb-2">92%</div>
                            <div class="text-gray-400">Completion Rate</div>
                        </div>
                        <div class="text-blue-400">
                            <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Project Management Section -->
            <div class="glass-card rounded-xl p-6 mb-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-blue-600 text-transparent bg-clip-text">
                        Project Management
                    </h1>
                    <div class="flex flex-col md:flex-row gap-4 w-full md:w-auto">
                        <select id="statusFilter" class="custom-input rounded-lg px-4 py-2 min-w-[160px]">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                        </select>
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search projects..."
                                class="custom-input rounded-lg pl-10 pr-4 py-2 w-full md:w-64">
                            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Projects Table -->
                <div class="overflow-x-auto">
                    <table class="w-full admin-table">
                        <thead>
                            <tr class="border-b border-gray-800">
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Project Name</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Notes</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="projectsList" class="divide-y divide-gray-800">
                            <!-- Projects will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
<div>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Creation Engine</title>
    <style>
    /* CSS Variables for Theming */
    :root {
      --primary-color: #1e1e1e;
      --secondary-color: #2c2c2c;
      --accent-color: #3b82f6;
      --accent-hover: #2563eb;
      --text-color: #f3f4f6;
      --border-color: #444;
      --button-text-color: #f3f4f6;
      --button-bg-color: #4f46e5;
      --button-hover-bg-color: #4338ca;
      --nav-background: rgba(0, 0, 0, 0.9);
      --nav-text-color: #f3f4f6;
      --nav-hover-color: #3b82f6;
      --logo-gradient: linear-gradient(90deg, #60a5fa, #3b82f6);
    }

    /* Container Styling */
    .blog-editor-container {
      width: 100%;
      min-height: 100vh;
      background-color: var(--primary-color);
      color: var(--text-color);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 20px;
      box-sizing: border-box;
    }

    /* Editor Wrapper */
    .editor-wrapper {
      width: 100%;
      max-width: 1200px;
      background-color: var(--secondary-color);
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .editor-wrapper:hover {
      transform: translateY(-5px);
    }

    /* Header */
    .editor-header {
      padding: 20px;
      background-color: var(--accent-color);
      text-align: center;
      font-size: 2rem;
      font-weight: bold;
      border-bottom: 2px solid var(--border-color);
    }

    /* Main Content */
    .editor-content {
      display: flex;
      flex-direction: row;
      height: 80vh;
    }

    /* Editor Section */
    .editor-section {
      width: 50%;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 20px;
      border-right: 2px solid var(--border-color);
      overflow-y: auto;
    }

    .editor-section h2 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    /* Textarea Styling */
    #editor {
      flex-grow: 1;
      padding: 15px;
      background-color: var(--primary-color);
      color: var(--text-color);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      resize: none;
      font-family: 'Courier New', Courier, monospace;
      font-size: 1rem;
      line-height: 1.5;
      overflow-y: auto;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    #editor:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    }

    /* Formatting Buttons */
    .formatting-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .formatting-buttons button {
      padding: 10px 15px;
      background-color: var(--button-bg-color);
      color: var(--button-text-color);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .formatting-buttons button:hover {
      background-color: var(--button-hover-bg-color);
      transform: translateY(-2px);
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 20px;
    }

    .action-buttons button {
      flex: 1;
      padding: 12px 20px;
      background-color: var(--accent-color);
      color: var(--button-text-color);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .action-buttons button:hover {
      background-color: var(--accent-hover);
      transform: translateY(-2px);
    }

    /* Preview Section */
    .preview-section {
      width: 50%;
      padding: 20px;
      box-sizing: border-box;
      background-color: var(--primary-color);
      display: flex;
      flex-direction: column;
      gap: 20px;
      overflow-y: auto;
    }

    .preview-section h2 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    /* Preview Template */
    .blog-preview {
      background-color: var(--secondary-color);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      color: var(--text-color);
      transition: background-color 0.3s ease, color 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    /* Navigation Bar in Preview */
    .blog-preview nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: var(--nav-background);
      border-bottom: 2px solid var(--border-color);
      border-radius: 12px 12px 0 0;
      position: relative;
    }

    .blog-preview nav .logo {
      font-size: 1.5rem;
      font-weight: bold;
      background: var(--logo-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .blog-preview nav .nav-links {
      display: flex;
      gap: 15px;
    }

    .blog-preview nav .nav-links a {
      color: var(--nav-text-color);
      text-decoration: none;
      font-size: 1rem;
      transition: color 0.3s ease;
    }

    .blog-preview nav .nav-links a:hover {
      color: var(--nav-hover-color);
    }

    /* Hamburger Menu */
    .blog-preview nav .hamburger {
      display: none;
      flex-direction: column;
      cursor: pointer;
      gap: 5px;
    }

    .blog-preview nav .hamburger div {
      width: 25px;
      height: 3px;
      background-color: var(--nav-text-color);
      transition: all 0.3s ease;
    }

    /* Mobile Menu */
    .blog-preview nav .mobile-nav {
      display: none;
      flex-direction: column;
      gap: 10px;
      background-color: var(--nav-background);
      position: absolute;
      top: 60px;
      right: 20px;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      z-index: 100;
    }

    .blog-preview nav .mobile-nav a {
      color: var(--nav-text-color);
      text-decoration: none;
      font-size: 1rem;
      transition: color 0.3s ease;
    }

    .blog-preview nav .mobile-nav a:hover {
      color: var(--nav-hover-color);
    }

    /* Toggle Active Class for Hamburger */
    .blog-preview nav .hamburger.active div:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .blog-preview nav .hamburger.active div:nth-child(2) {
      opacity: 0;
    }

    .blog-preview nav .hamburger.active div:nth-child(3) {
      transform: rotate(-45deg) translate(5px, -5px);
    }

    /* Blog Content */
    .blog-content {
      flex-grow: 1;
      padding: 20px;
      overflow-y: auto;
    }

    .blog-content img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin: 10px 0;
    }

    .blog-content blockquote {
      border-left: 4px solid var(--accent-color);
      padding-left: 16px;
      color: #ccc;
      font-style: italic;
      margin: 10px 0;
      background-color: #2c2c2c;
      padding: 10px;
      border-radius: 4px;
    }

    .blog-content pre {
      background-color: #1e1e1e;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 10px 0;
    }

    .blog-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }

    .blog-content th, .blog-content td {
      border: 1px solid var(--accent-color);
      padding: 8px;
      text-align: left;
    }

    .blog-content ul, .blog-content ol {
      margin: 10px 0;
      padding-left: 20px;
    }

    .blog-content hr {
      border: none;
      border-top: 1px solid var(--border-color);
      margin: 20px 0;
    }

    /* Scrollbar Styling */
    .editor-section::-webkit-scrollbar,
    .preview-section::-webkit-scrollbar {
      width: 8px;
    }

    .editor-section::-webkit-scrollbar-track,
    .preview-section::-webkit-scrollbar-track {
      background: var(--secondary-color);
      border-radius: 4px;
    }

    .editor-section::-webkit-scrollbar-thumb,
    .preview-section::-webkit-scrollbar-thumb {
      background-color: var(--accent-color);
      border-radius: 4px;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .editor-content {
        flex-direction: column;
      }

      .editor-section, .preview-section {
        width: 100%;
        border-right: none;
        border-bottom: 2px solid var(--border-color);
      }
    }

    /* Preview Navigation Responsive */
    @media (max-width: 768px) {
      .blog-preview nav .nav-links {
        display: none;
      }

      .blog-preview nav .hamburger {
        display: flex;
      }

      .blog-preview nav .mobile-nav {
        display: flex;
      }
    }

    /* Footer in Preview */
    .blog-preview footer {
      padding: 20px;
      background-color: var(--nav-background);
      border-top: 2px solid var(--border-color);
      border-radius: 0 0 12px 12px;
      text-align: center;
      font-size: 0.9rem;
    }

    .blog-preview footer a {
      color: var(--nav-text-color);
      text-decoration: none;
      margin: 0 10px;
      transition: color 0.3s ease;
    }

    .blog-preview footer a:hover {
      color: var(--nav-hover-color);
    }

    .hidden {
      display: none !important;
    }
    </style>
</head>
<body>
    <div class="blog-editor-container">
        <div class="editor-wrapper">
            <div class="editor-header">Blog Creation Engine</div>
            <div class="editor-content">
                <div class="editor-section">
                    <h2>Editor</h2>
                    <textarea id="editor" placeholder="Enter your blog content here..."></textarea>
                    <div class="formatting-buttons">
                        <button onclick="insertFormatting('@')">Title</button>
                        <button onclick="insertFormatting('@@')">Subtitle</button>
                        <button onclick="insertFormatting('#')">H1</button>
                        <button onclick="insertFormatting('##')">H2</button>
                        <button onclick="insertFormatting('###')">H3</button>
                        <button onclick="insertFormatting('>>>>')">Quote</button>
                        <button onclick="insertCodeBlock()">Code</button>
                        <button onclick="insertTable()">Table</button>
                        <button onclick="insertImage()">Image</button>
                        <button onclick="insertFormatting('~~')">HR</button>
                        <button onclick="insertFormatting('++')">Bullet List</button>
                        <button onclick="insertFormatting('***')">Number List</button>
                    </div>
                    <div class="action-buttons">
                        <button onclick="processContent()">Process & Preview</button>
                        <button onclick="saveContent()">Save Draft</button>
                    </div>
                </div>
                <div class="preview-section">
                    <h2>Preview</h2>
                    <div class="blog-preview" id="preview">
                        <nav>
                            <div class="logo">Nextap AI</div>
                            <div class="nav-links">
                                <a href="#services">Services</a>
                                <a href="#testimonials">Testimonials</a>
                                <a href="#calculator">Get Quote</a>
                                <a href="dashboard.html">Dashboard</a>
                                <a href="admin.html">Admin</a>
                                <a href="blogs.html">Blogs</a>
                            </div>
                            <div class="hamburger" onclick="togglePreviewMenu()">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="mobile-nav hidden">
                                <a href="#services">Services</a>
                                <a href="#testimonials">Testimonials</a>
                                <a href="#calculator">Get Quote</a>
                                <a href="dashboard.html">Dashboard</a>
                                <a href="admin.html">Admin</a>
                                <a href="blogs.html">Blogs</a>
                            </div>
                        </nav>
                        <div class="blog-content" id="blogContent">
                            <p>Your blog content will appear here after processing.</p>
                        </div>
                        <footer>
                            <a href="Privacy Policy.html">Privacy Policy</a>
                            <a href="Terms of Service.html">Terms of Service</a>
                            <a href="Contact Us.html">Contact Us</a>
                            <a href="blogs.html">Blogs</a>
                            <a href="testimonials.html">Testimonials</a>
                            <div class="footer-bottom">
                                &copy; 2023 Nextap AI. All rights reserved.
                            </div>
                        </footer>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyCE444N0GxkkQhfD5Hzws4jyvTV-bEuVJA";
        let lastSavedContent = '';

        // Initialize from localStorage
        document.addEventListener('DOMContentLoaded', () => {
            const savedDraft = localStorage.getItem('blogDraft');
            if (savedDraft) {
                document.getElementById('editor').value = savedDraft;
                processContent();
            }
        });

        // Auto-save every 30 seconds
        setInterval(() => {
            const currentContent = document.getElementById('editor').value;
            if (currentContent !== lastSavedContent) {
                saveContent();
            }
        }, 30000);

        // Insert Formatting
        function insertFormatting(format) {
            const editor = document.getElementById('editor');
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const text = editor.value;
            const selectedText = text.substring(start, end);
            let newText = '';

            switch(format) {
                case '@':
                    newText = `${format} ${selectedText}\n`;
                    break;
                case '@@':
                    newText = `${format} ${selectedText}\n`;
                    break;
                case '#':
                case '##':
                case '###':
                    newText = `${format} ${selectedText}\n`;
                    break;
                case '>>>>':
                    newText = `${format} ${selectedText}\n`;
                    break;
                case '~~':
                    newText = `${format}\n`;
                    break;
                case '++':
                    newText = `${format} ${selectedText}\n`;
                    break;
                case '***':
                    newText = `${format} ${selectedText}\n`;
                    break;
                default:
                    newText = `${format} ${selectedText}\n`;
            }

            editor.setRangeText(newText, start, end, 'end');
            editor.focus();
        }

        // Insert Code Block
        function insertCodeBlock() {
            const editor = document.getElementById('editor');
            const selectText = window.getSelection().toString();
            const selectedText = selectText ? selectText : 'Your code here';
            const codeBlock = `[[[[\n${selectedText}\n]]]]\n`;
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            editor.setRangeText(codeBlock, start, end, 'end');
            editor.focus();
        }

        // Insert Table
        function insertTable() {
            const tableTemplate = 'Header 1 | Header 2 | Header 3\n---|---|---\nCell 1 | Cell 2 | Cell 3\n';
            const tableBlock = `<<T>>\n${tableTemplate}>>T<<\n`;
            const editor = document.getElementById('editor');
            const pos = editor.selectionStart;
            editor.setRangeText(tableBlock, pos, pos, 'end');
            editor.focus();
        }

        // Insert Image
        function insertImage() {
            const imageUrl = prompt('Enter image URL:');
            if (imageUrl) {
                const caption = prompt('Enter image caption:') || '';
                const imageBlock = `[IMG_SRC]${imageUrl}[IMG_CAP]${caption}\n`;
                const editor = document.getElementById('editor');
                const pos = editor.selectionStart;
                editor.setRangeText(imageBlock, pos, pos, 'end');
                editor.focus();
            }
        }

        // Process Content
        async function processContent() {
            const content = document.getElementById('editor').value;
            if (!content.trim()) {
                alert('Editor is empty. Please enter some content.');
                return;
            }

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{ role: "user", parts: [{ text: content }] }],
                        systemInstruction: {
                            role: "user",
                            parts: [{
                                text: `Identify and mark text with these exact identifiers. Do not modify the content itself:
                                Main Title before text [M_TITLE]
                                Subtitle before text [S_TITLE]
                                H1 Heading before text [H1]
                                H2 Heading before text [H2]
                                H3 Heading before text [H3]
                                [QUOTE] before paragraph [QUOTE]
                                Code Block start [CODE_START] Code Block end [CODE_END]
                                Table start [TABLE_START] Table end [TABLE_END]
                                Image link [IMG_SRC]
                                Image caption [IMG_CAP]
                                Horizontal Rule on its own line [HR]
                                Bullet List item before text [BULLET]
                                Numbered List item before text [NUMBER]
                                
                                Rules:
                                Add marker immediately before relevant text
                                Keep original text exactly as is
                                Only add markers where formatting is clearly intended
                                Do not add HTML or styling
                                Do not modify spacing or line breaks
                                Do not add any other markers or formatting`
                            }]
                        },
                        generationConfig: {
                            temperature: 0.01,
                            topK: 40,
                            topP: 0.95,
                            maxOutputTokens: 8192,
                            responseMimeType: "text/plain"
                        }
                    })
                });

                if (!response.ok) throw new Error('API request failed');

                const data = await response.json();
                const processedContent = data.candidates[0].content.parts[0].text;
                const html = convertToHtml(processedContent);
                document.getElementById('blogContent').innerHTML = html;

                // Initialize the Preview Nav Menu
                initializePreviewNav();
            } catch (error) {
                console.error('Error processing content:', error);
                alert('Error processing content. Please try again.');
                document.getElementById('blogContent').innerHTML = '<p style="color: red;">Failed to process content.</p>';
            }

            lastSavedContent = content;
        }

        // Convert Markdown-like Syntax to HTML
        function convertToHtml(content) {
            let html = content
                // Headers
                .replace(/\[M_TITLE\](.*?)(?=\n|$)/g, '<h1>$1</h1>')
                .replace(/\[S_TITLE\](.*?)(?=\n|$)/g, '<h2>$1</h2>')
                .replace(/\[H1\](.*?)(?=\n|$)/g, '<h3>$1</h3>')
                .replace(/\[H2\](.*?)(?=\n|$)/g, '<h4>$1</h4>')
                .replace(/\[H3\](.*?)(?=\n|$)/g, '<h5>$1</h5>')
                // Block elements
                .replace(/\[QUOTE\](.*?)(?=\n|$)/g, '<blockquote>$1</blockquote>')
                .replace(/\[CODE_START\]([\s\S]*?)\[CODE_END\]/g, '<pre><code>$1</code></pre>')
                .replace(/\[TABLE_START\]([\s\S]*?)\[TABLE_END\]/g, (match, table) => {
                    const rows = table.trim().split('\n').map(row => {
                        const cells = row.split('|').map(cell => `<td>${cell.trim()}</td>`).join('');
                        return `<tr>${cells}</tr>`;
                    });
                    return `<table>${rows.join('')}</table>`;
                })
                // Images
                .replace(/\[IMG_SRC\](.*?)\[IMG_CAP\](.*?)(?=\n|$)/g, '<figure><img src="$1" alt="$2"><figcaption>$2</figcaption></figure>')
                // Lists
                .replace(/\[BULLET\](.*?)(?=\n|$)/g, '<li>$1</li>')
                .replace(/\[NUMBER\](.*?)(?=\n|$)/g, '<li>$1</li>')
                // Horizontal Rule
                .replace(/\[HR\]/g, '<hr>');

            // Wrap Bullet Lists
            html = html.replace(/(<li>.*?<\/li>)/g, (match) => {
                return '<ul>' + match + '</ul>';
            });

            // Wrap Numbered Lists
            html = html.replace(/(<li>.*?<\/li>)/g, (match) => {
                return '<ol>' + match + '</ol>';
            });

            // Convert remaining plain text to paragraphs
            html = html.replace(/^(?!<h[1-5]>|<blockquote>|<pre>|<table>|<figure>|<ul>|<ol>|<hr>)(.*?)(?=\n|$)/gm, '<p>$1</p>');

            return html;
        }

        function saveContent() {
  const content = document.getElementById('editor').value;
  const previewElement = document.querySelector('.blog-preview');
  const previewContent = previewElement ? previewElement.outerHTML : '';
  
  // Get all styles from the current document
  const styleTags = document.querySelectorAll('style');
  let styles = '';
  styleTags.forEach(styleTag => {
    styles += styleTag.textContent + '\n';
  });

  // Create a complete HTML document with the same styling as preview
  const fullHtml = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Blog Post</title>
      <style>
        ${styles}
        /* Additional styles for standalone page */
        body {
          margin: 0;
          padding: 20px;
          background-color: var(--primary-color);
          min-height: 100vh;
          display: flex;
          justify-content: center;
        }
        .blog-preview {
          width: 100%;
          max-width: 1200px;
          margin: 0 auto;
        }
      </style>
    </head>
    <body>
      ${previewContent}
      <script>
        // Initialize mobile menu functionality
        function togglePreviewMenu() {
          const previewNav = document.querySelector('.blog-preview nav');
          if (previewNav) {
            const hamburger = previewNav.querySelector('.hamburger');
            const mobileNav = previewNav.querySelector('.mobile-nav');
            if (hamburger && mobileNav) {
              hamburger.classList.toggle('active');
              mobileNav.classList.toggle('hidden');
            }
          }
        }

        // Initialize navigation
        document.addEventListener('DOMContentLoaded', () => {
          const hamburger = document.querySelector('.hamburger');
          if (hamburger) {
            hamburger.addEventListener('click', togglePreviewMenu);
          }
        });
      <\/script> <!-- Escaped closing script tag -->
    </body>
    </html>
  `;

  // Create a Blob containing the HTML content
  const blob = new Blob([fullHtml], { type: 'text/html' });

  // Create a temporary link element
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'blog_post.html';

  // Trigger the download
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);

  // Save to localStorage with timestamp
  const timestamp = new Date().getTime();
  const randomNumber = Math.floor(Math.random() * 900000) + 100000;
  const draftID = `blogDraft_${timestamp}_${randomNumber}`;
  localStorage.setItem(draftID, content);

  // Assuming lastSavedContent is defined elsewhere in your code
  if (typeof lastSavedContent !== 'undefined') {
    lastSavedContent = content;
  }

  alert(`Draft saved successfully! Your Draft ID is: ${draftID}`);
}

// Handle Paste Events to Maintain Formatting
const editor = document.getElementById('editor');
if (editor) {
  editor.addEventListener('paste', (e) => {
    e.preventDefault();
    const text = e.clipboardData.getData('text/plain');
    const start = editor.selectionStart;
    const end = editor.selectionEnd;
    editor.setRangeText(text, start, end, 'end');
  });
}

        // Initialize Preview Navigation Menu Function
        function initializePreviewNav() {
            const previewNav = document.querySelector('.blog-preview nav');
            if (previewNav) {
                const hamburger = previewNav.querySelector('.hamburger');
                const mobileNav = previewNav.querySelector('.mobile-nav');

                // Ensure no duplicate event listeners
                hamburger.removeEventListener('click', togglePreviewMenu);
                hamburger.addEventListener('click', togglePreviewMenu);
            }
        }

        // Toggle Preview Mobile Menu
        function togglePreviewMenu() {
            const previewNav = document.querySelector('.blog-preview nav');
            const hamburger = previewNav.querySelector('.hamburger');
            const mobileNav = previewNav.querySelector('.mobile-nav');

            hamburger.classList.toggle('active');
            mobileNav.classList.toggle('hidden');
        }
    </script>
</body>
</div>

    <script>
        // Constants
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxg8EzW2SELN_MTWrHloPAlryH1YmzT-e3QbAiO8z3RJg89QdovVcI0S8d0iL9agAzbxg/exec';
        const ADMIN_CREDENTIALS = {
            username: 'admin',
            password: 'password'
        };

        // State management
        let projectsData = [];
        let saveTimeouts = {};

        // Initialize dashboard
        function initAdminDashboard() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            if (!isLoggedIn) {
                showLoginModal();
            } else {
                hideLoginModal();
                loadProjects();
                initializeEventListeners();
            }
        }

        // Event Listeners
        function initializeEventListeners() {
            document.getElementById('searchInput').addEventListener('input', filterProjects);
            document.getElementById('statusFilter').addEventListener('change', filterProjects);
            
            // Auto-save functionality for notes
            document.addEventListener('input', (e) => {
                if (e.target.classList.contains('notes-input')) {
                    const projectId = e.target.closest('tr').dataset.projectId;
                    handleAutoSave(projectId, e.target.value);
                }
            });
        }

        // Login handling
        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === ADMIN_CREDENTIALS.username && 
                password === ADMIN_CREDENTIALS.password) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                hideLoginModal();
                loadProjects();
            } else {
                showError('Invalid credentials');
            }
        };

        // Project loading and rendering
        async function loadProjects() {
            showLoadingState();
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getProjects`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || 'Failed to load projects');
                }

                projectsData = data.projects;
                renderProjects(projectsData);
                updateStatistics();
            } catch (error) {
                showError('Error loading projects: ' + error.message);
            } finally {
                hideLoadingState();
            }
        }

        function renderProjects(projects) {
            const tbody = document.getElementById('projectsList');
            tbody.innerHTML = projects.map((project, index) => `
                <tr class="project-row" 
                    data-project-id="${project.project_id}"
                    style="animation-delay: ${index * 0.05}s">
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <span class="font-medium">${project.project_id}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <div class="flex flex-col">
                            <span class="font-medium">${project.client_email}</span>
                            <span class="text-gray-400 text-xs">${project.client_name || ''}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        ${project.project_name}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <select class="status-select custom-input rounded-lg px-3 py-2 text-sm"
                                onchange="handleStatusChange(event, '${project.project_id}')">
                            <option value="pending" ${project.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="active" ${project.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="completed" ${project.status === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </td>
                    <td class="px-6 py-4">
                        <textarea class="notes-input custom-input w-full rounded-lg px-3 py-2 text-sm min-h-[80px]">${project.proj_notes || ''}</textarea>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <button onclick="saveChanges('${project.project_id}')"
                                class="save-button bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all flex items-center gap-2">
                            <span>Save</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Project updates
        async function handleStatusChange(event, projectId) {
            const status = event.target.value;
            try {
                await updateProjectStatus(projectId, status);
                showSuccess('Status updated successfully');
            } catch (error) {
                showError(error.message);
                // Revert the select to previous value
                event.target.value = projectsData.find(p => p.project_id === projectId).status;
            }
        }

        function handleAutoSave(projectId, notes) {
            // Clear existing timeout for this project
            if (saveTimeouts[projectId]) {
                clearTimeout(saveTimeouts[projectId]);
            }

            // Set new timeout
            saveTimeouts[projectId] = setTimeout(async () => {
                try {
                    await updateProjectNotes(projectId, notes);
                    showSuccess('Notes saved automatically', 2000);
                } catch (error) {
                    showError(error.message);
                }
            }, 1000);
        }

        async function saveChanges(projectId) {
            const row = document.querySelector(`tr[data-project-id="${projectId}"]`);
            const button = row.querySelector('button');
            const status = row.querySelector('.status-select').value;
            const notes = row.querySelector('.notes-input').value;

            try {
                button.disabled = true;
                button.innerHTML = '<span>Saving...</span>';

                await Promise.all([
                    updateProjectStatus(projectId, status),
                    updateProjectNotes(projectId, notes)
                ]);

                showSuccess('Changes saved successfully');
                button.innerHTML = '<span>Saved!</span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
            } catch (error) {
                showError(error.message);
                button.innerHTML = '<span>Save</span>';
            } finally {
                setTimeout(() => {
                    button.disabled = false;
                    button.innerHTML = '<span>Save</span><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>';
                }, 2000);
            }
        }

        // API calls
        async function updateProjectStatus(projectId, status) {
            const response = await fetch(`${SCRIPT_URL}?action=updateProject`, {
                method: 'POST',
                body: new URLSearchParams({
                    project_id: projectId,
                    status: status
                })
            });

            const data = await response.json();
            if (!data.success) {
                throw new Error(data.message || 'Failed to update status');
            }

            // Update local data
            const project = projectsData.find(p => p.project_id === projectId);
            if (project) {
                project.status = status;
            }
        }

        async function updateProjectNotes(projectId, notes) {
            const response = await fetch(`${SCRIPT_URL}?action=updateProject`, {
                method: 'POST',
                body: new URLSearchParams({
                    project_id: projectId,
                    notes: notes
                })
            });

            const data = await response.json();
            if (!data.success) {
                throw new Error(data.message || 'Failed to update notes');
            }

            // Update local data
            const project = projectsData.find(p => p.project_id === projectId);
            if (project) {
                project.proj_notes = notes;
            }
        }

        // UI helpers
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('adminDashboard').classList.remove('hidden');
        }

        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            showLoginModal();
        }

        function refresh() {
            loadProjects();
        }

        function showLoadingState() {
            // Add loading state UI if needed
        }

        function hideLoadingState() {
            // Remove loading state UI if needed
        }

        function showSuccess(message, duration = 3000) {
            // Implement toast notification
            console.log('Success:', message);
        }

        function showError(message) {
            // Implement error notification
            console.error('Error:', message);
        }

        // Search and filter
        function filterProjects() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            const filteredProjects = projectsData.filter(project => {
                const matchesSearch = 
                    project.project_id.toLowerCase().includes(searchTerm) ||
                    project.client_email.toLowerCase().includes(searchTerm) ||
                    project.project_name.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || project.status === statusFilter;
                return matchesSearch && matchesStatus;
            });

            renderProjects(filteredProjects);
        }

        // Statistics
        function updateStatistics() {
            const activeProjects = projectsData.filter(p => p.status === 'active').length;
            const pendingProjects = projectsData.filter(p => p.status === 'pending').length;
            const completedProjects = projectsData.filter(p => p.status === 'completed').length;
            const totalProjects = projectsData.length;

            const completionRate = totalProjects ? Math.round((completedProjects / totalProjects) * 100) : 0;

            // Update stats in the UI
            document.querySelector('.stats-card:nth-child(1) .text-4xl').textContent = activeProjects;
            document.querySelector('.stats-card:nth-child(2) .text-4xl').textContent = pendingProjects;
            document.querySelector('.stats-card:nth-child(3) .text-4xl').textContent = `${completionRate}%`;
        }

        // Initialize on load
        window.addEventListener('load', initAdminDashboard);
    </script>
</body>
</html>
